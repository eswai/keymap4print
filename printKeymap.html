<html>
  <head>
    <meta charset="utf-8" />
    <title>Keymap</title>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="KLEparser.js"></script>
    <script src="svg.min.js"></script>
    <script src="https://unpkg.com/vue-swatches"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css">
  </head>
  <body>
    <div class="container">
      <section class="section">
        <h1 class="title">Keyboard Layout 3D Viewer</h1>
        <div id="app">
          <div class="field">
            <label class="label">Keyboard Layout Editor Raw data (Raw data is now supported!)</label>
            <div class="control">
              <textarea v-model="rawdata" placeholder="Raw data" class="textarea"></textarea>
            </div>
          </div>

          <div class="field is-grouped">
            <div class="control">
              <button id="renderBtn" v-on:click="renderKB" class="button is-dark">Render</button>
            </div>
          </div>
          <div id="keymap"></div>
        </div>
      </section>

      <footer class="footer">
        <div class="content has-text-centered">
          <p>
            <strong>Keymap</strong> by <a href="https://github.com/eswai/">eswai</a>. The source code is licensed
            <a href="http://opensource.org/licenses/mit-license.php">MIT</a>.
          </p>
        </div>
      </footer>
    </div>
  </body>

  <script type="text/javascript">
    const keypitch = 50
    const keygap = 4
    const fontsize = 15

    var app = new Vue({
      el: '#app',
      data: {
        draw: "",
        rawdata: "[{r:10,rx:1,y:-0.1,x:2,c:\"#e3e3e3\"},\"E\"],[{y:-0.65,x:1},\"W\",{x:1},\"R\"],[{y:-0.75},\"Q\"],[{y:-0.9,x:4},\"T\"],[{y:-0.7,x:2},\"D\"],[{y:-0.65,x:1},\"S\",{x:1},\"F\"],[{y:-0.75},\"A\"],[{y:-0.9,x:4},\"G\"],[{y:-0.7,x:2},\"C\"],[{y:-0.65,x:1},\"X\",{x:1},\"V\"],[{y:-0.75},\"Z\"],[{y:-0.9,x:4},\"B\"],[{y:-0.75,x:5,c:\"#575757\",t:\"#ffffff\",h:1.5},\"Ctrl\"],[{y:-0.95,x:2},\"super\"],[{y:-0.65,x:1},\"Tab\",{x:1},\"Shift\"],[{y:-0.75,c:\"#ab0202\",t:\"#e3e3e3\"},\"Esc\"],[{y:-0.9,x:4,c:\"#575757\",t:\"#ffffff\"},\"Bksp\"],[{r:-10,rx:7,ry:0.965,y:-0.2,x:2,c:\"#e3e3e3\",t:\"#000000\"},\"I\"],[{y:-0.65,x:1},\"U\",{x:1},\"O\"],[{y:-0.75,x:4},\"P\"],[{y:-0.9},\"Y\"],[{y:-0.7,x:2},\"K\"],[{y:-0.65,x:1},\"J\",{x:1},\"L\"],[{y:-0.75,x:4},\":\"],[{y:-0.9},\"H\"],[{y:-0.7,x:2},\"<\"],[{y:-0.65,x:1},\"M\",{x:1},\">\"],[{y:-0.75,x:4},\"?\"],[{y:-0.9},\"N\"],[{y:-0.75,x:-1,c:\"#575757\",t:\"#ffffff\",h:1.5},\"Alt\"],[{y:-0.95,x:2,c:\"#e3e3e3\",t:\"#000000\"},\"_\"],[{y:-0.65,x:1,c:\"#575757\",t:\"#ffffff\"},\"fn\",{x:1,c:\"#e3e3e3\",t:\"#000000\"},\"\\\"\"],[{y:-0.75,x:4,c:\"#ab0202\",t:\"#e3e3e3\"},\"Enter\"],[{y:-0.9,c:\"#e3e3e3\",t:\"#000000\"},\"Space\"]"
      },


      created: function() {
      },

      methods: {
        renderKB: function() {
          var that = this

          if (that.draw == "") that.draw = SVG("keymap").size(1500, 500)

          // parse KLE data and render keyboard
          var kb = KLEparser(that.rawdata)
          that.draw.clear()
          kb.keys.forEach(function(key){
            var kc = that.draw.rect(key.w * keypitch - keygap, key.h * keypitch - keygap)
                         .radius(3)
                         .fill('#fff')
                         .stroke('#000')
            var bk = kc.bbox()
            kc.move(key.centerX() * keypitch - bk.width / 2, key.centerY() * keypitch - bk.height / 2)
              .rotate(key.r * 180 / Math.PI)

            var t0 = that.draw.text("X")
                        .font({ fill: '#000', family: 'Helvetica' })
                        .size(fontsize)
            var bt0 = t0.bbox()
            t0.move(key.centerX() * keypitch - bt0.width / 2, key.centerY() * keypitch - bt0.height / 2)
             .rotate(key.r * 180 / Math.PI)

            var t1 = that.draw.text("X")
                        .font({ fill: '#a00', family: 'Helvetica' })
                        .size(12)
            var bt1 = t1.bbox()
            t1.move(key.centerX() * keypitch - bt1.width / 2 - 13, key.centerY() * keypitch - bt1.height / 2 - 13)
             .rotate(key.r * 180 / Math.PI)

            var t2 = that.draw.text("X")
                        .font({ fill: '#00a', family: 'Helvetica' })
                        .size(12)
            var bt2 = t2.bbox()
            t2.move(key.centerX() * keypitch - bt2.width / 2 + 13, key.centerY() * keypitch - bt2.height / 2 - 13)
             .rotate(key.r * 180 / Math.PI)

            var t3 = that.draw.text("X")
                        .font({ fill: '#0a0', family: 'Helvetica' })
                        .size(12)
            var bt3 = t3.bbox()
            t3.move(key.centerX() * keypitch - bt3.width / 2 - 13, key.centerY() * keypitch - bt3.height / 2 + 13)
             .rotate(key.r * 180 / Math.PI)

            var t4 = that.draw.text("X")
                        .font({ fill: '#aa0', family: 'Helvetica' })
                        .size(12)
            var bt4 = t4.bbox()
            t4.move(key.centerX() * keypitch - bt4.width / 2 + 13, key.centerY() * keypitch - bt4.height / 2 + 13)
             .rotate(key.r * 180 / Math.PI)
          })
        }
      }
    })
  </script>
</html>
